if (self.CavalryLogger) { CavalryLogger.start_js(["Nxar6"]); }

__d("MWMSImagePostbackCtaHandler.bs",["Promise","URI","FBID.bs","bs_block","bs_curry","React","ActorURI","bs_caml_array","bs_caml_option","promiseDone","MercuryConfig","MWChatThreadId.bs","MercuryLocalIDs","MWMSSendTextMessage.bs","MWThread_DEPRECATED.bs","useCometRouterState","MWMSSendFilesMessage.bs","XComposerPhotoUploader","MWUIPresenceIsThreadActive.bs"],(function(a,b,c,d,e,f){"use strict";var g,h=b("React");function a(a){var c=b("MWMSSendTextMessage.bs").useSendTextMessage(0),d=b("MWThread_DEPRECATED.bs").useIdExn(0),e=b("useCometRouterState")(),f=b("bs_curry")._1(b("MWUIPresenceIsThreadActive.bs").useHook,0);return h.useMemo(function(){return function(a,h,i){a=a;h=h;i=i;b("bs_curry")._4(c,d,h,void 0,void 0);h=b("MWChatThreadId.bs").getFBID(d);var j=d;i=i;var k=f,l=e,m=a,n=b("MercuryLocalIDs").generateOfflineThreadingID(void 0),o=new(b("XComposerPhotoUploader"))({concurrentLimit:3,onUploadFailure:function(a,b){return!0},onUploadProgress:function(a,b){return 0},onUploadStart:function(a){return 0},onUploadSuccess:function(a,c){a=b("bs_caml_array").caml_array_get(c.response.payload.metadata,0);c=a.image_id;if(c!==void 0){a=b("bs_caml_option").valFromOption(c);return b("MWMSSendFilesMessage.bs").send(b("bs_caml_option").some(m),j,b("bs_block").__(0,[{media_attachment_ids:[b("FBID.bs").ofStringExn(a)],offline_threading_id:b("bs_caml_option").some(n)}]),void 0,l,k,0)}else return 0},retryLimit:1,uploadEndpoint:new(b("ActorURI").create)(new(g||(g=b("URI")))(b("MercuryConfig").upload_url),h)});a=window.fetch(i).then(function(a){return a.blob()}).then(function(a){o.getAsyncUploadRequest([new File([a],"postback image.jpg",{type:"image/jpeg"})],void 0).send();return b("Promise").resolve(0)});b("promiseDone")(a,void 0,void 0);return 0}},[d,c,e,f])}f.usePostbackCtaHandler=a}),null);